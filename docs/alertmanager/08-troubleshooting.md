# üîß M√≥dulo 8: Troubleshooting do Alertmanager

> **Objetivo:** Aprender a diagnosticar e resolver problemas comuns do Alertmanager

---

## üìã √çNDICE

1. [Diagn√≥stico Inicial](#1-diagn√≥stico-inicial)
2. [Logs e Debugging](#2-logs-e-debugging)
3. [M√©tricas de Monitoramento](#3-m√©tricas-de-monitoramento)
4. [Problemas de Configura√ß√£o](#4-problemas-de-configura√ß√£o)
5. [Problemas de Conectividade](#5-problemas-de-conectividade)
6. [Problemas de Notifica√ß√£o](#6-problemas-de-notifica√ß√£o)
7. [Problemas de Performance](#7-problemas-de-performance)
8. [Ferramentas de Diagn√≥stico](#8-ferramentas-de-diagn√≥stico)
9. [Cen√°rios Comuns](#9-cen√°rios-comuns)
10. [Preven√ß√£o de Problemas](#10-preven√ß√£o-de-problemas)

---

## 1. DIAGN√ìSTICO INICIAL

### ü©∫ Checklist de Sa√∫de

#### ‚úÖ Verifica√ß√µes B√°sicas
```bash
# 1. Status do servi√ßo
docker-compose ps alertmanager

# 2. Logs recentes
docker-compose logs --tail=50 alertmanager

# 3. Conectividade
curl -s http://localhost:9093/-/healthy

# 4. Configura√ß√£o v√°lida
docker exec alertmanager amtool config show

# 5. Alertas ativos
curl -s http://localhost:9093/api/v1/alerts | jq '.data | length'
```

#### üîç Status da Interface Web
```bash
# Verificar se a interface est√° acess√≠vel
curl -I http://localhost:9093/

# Verificar API
curl -s http://localhost:9093/api/v1/status | jq '.status'

# Verificar receivers
curl -s http://localhost:9093/api/v1/receivers | jq '.data[].name'
```

### üìä Dashboard de Sa√∫de

#### üéØ M√©tricas Essenciais
```promql
# Alertmanager est√° rodando?
up{job="alertmanager"}

# Alertas sendo processados?
rate(alertmanager_alerts_received_total[5m])

# Notifica√ß√µes sendo enviadas?
rate(alertmanager_notifications_total[5m])

# Erros de notifica√ß√£o?
rate(alertmanager_notifications_failed_total[5m])
```

---

## 2. LOGS E DEBUGGING

### üìù Configura√ß√£o de Logs

#### üîß N√≠veis de Log
```yaml
# alertmanager.yml
global:
  # Configura√ß√µes globais...

# Via linha de comando
command:
  - '--log.level=debug'    # debug, info, warn, error
  - '--log.format=json'    # json ou logfmt
```

#### üê≥ Docker Compose com Debug
```yaml
# compose.yml
services:
  alertmanager:
    image: prom/alertmanager:latest
    command:
      - '--config.file=/etc/alertmanager/alertmanager.yml'
      - '--storage.path=/alertmanager'
      - '--web.external-url=http://localhost:9093'
      - '--log.level=debug'
      - '--log.format=json'
    volumes:
      - ./alertmanager.yml:/etc/alertmanager/alertmanager.yml
    ports:
      - "9093:9093"
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
```

### üîç An√°lise de Logs

#### üìã Logs Importantes
```bash
# Logs de inicializa√ß√£o
docker-compose logs alertmanager | grep -E "(Starting|Listening|Config)"

# Logs de erro
docker-compose logs alertmanager | grep -E "(ERROR|WARN|error|failed)"

# Logs de notifica√ß√£o
docker-compose logs alertmanager | grep -E "(notification|notify|sent)"

# Logs de configura√ß√£o
docker-compose logs alertmanager | grep -E "(config|reload|template)"
```

#### üéØ Padr√µes de Log
```json
// Log de sucesso na notifica√ß√£o
{
  "level": "info",
  "ts": "2024-01-15T10:30:00.000Z",
  "caller": "notify/notify.go:732",
  "msg": "Completed successfully",
  "receiver": "web.hook",
  "integration": "webhook",
  "attempts": 1
}

// Log de erro na notifica√ß√£o
{
  "level": "error",
  "ts": "2024-01-15T10:30:00.000Z",
  "caller": "notify/webhook.go:108",
  "msg": "Notify attempt failed",
  "receiver": "web.hook",
  "integration": "webhook",
  "attempts": 1,
  "err": "Post \"http://webhook.example.com\": dial tcp: connection refused"
}
```

### üîß Debug Avan√ßado

#### üéØ Rastreamento de Alertas
```bash
# Seguir logs em tempo real
docker-compose logs -f alertmanager

# Filtrar por alerta espec√≠fico
docker-compose logs alertmanager | grep "DatabaseDown"

# Filtrar por receiver
docker-compose logs alertmanager | grep "slack-alerts"

# Logs estruturados com jq
docker-compose logs alertmanager --since=1h | \
  grep '^{' | jq 'select(.receiver == "slack-alerts")'
```

---

## 3. M√âTRICAS DE MONITORAMENTO

### üìä M√©tricas Essenciais

#### üéØ Alertas Recebidos
```promql
# Taxa de alertas recebidos
rate(alertmanager_alerts_received_total[5m])

# Alertas ativos por estado
alertmanager_alerts{state="active"}
alertmanager_alerts{state="suppressed"}

# Alertas inv√°lidos
rate(alertmanager_alerts_invalid_total[5m])
```

#### üì§ Notifica√ß√µes
```promql
# Taxa de notifica√ß√µes enviadas
rate(alertmanager_notifications_total[5m])

# Taxa de falhas por receiver
rate(alertmanager_notifications_failed_total[5m]) by (receiver)

# Lat√™ncia de notifica√ß√µes
histogram_quantile(0.95, 
  rate(alertmanager_notification_latency_seconds_bucket[5m])
) by (receiver)
```

#### üîÑ Configura√ß√£o
```promql
# √öltima recarga de configura√ß√£o
alertmanager_config_last_reload_success_timestamp_seconds

# Falhas na recarga
rate(alertmanager_config_last_reload_successful[5m]) == 0

# Hash da configura√ß√£o atual
alertmanager_config_hash
```

### üìà Dashboard de Monitoramento

#### üéØ Grafana Dashboard
```json
{
  "dashboard": {
    "title": "Alertmanager Health",
    "panels": [
      {
        "title": "Alerts Received Rate",
        "type": "graph",
        "targets": [{
          "expr": "rate(alertmanager_alerts_received_total[5m])"
        }]
      },
      {
        "title": "Notification Success Rate",
        "type": "stat",
        "targets": [{
          "expr": "(
            rate(alertmanager_notifications_total[5m]) - 
            rate(alertmanager_notifications_failed_total[5m])
          ) / rate(alertmanager_notifications_total[5m]) * 100"
        }]
      },
      {
        "title": "Active Alerts",
        "type": "stat",
        "targets": [{
          "expr": "alertmanager_alerts{state=\"active\"}"
        }]
      }
    ]
  }
}
```

---

## 4. PROBLEMAS DE CONFIGURA√á√ÉO

### ‚ùå Erros Comuns

#### üîß Sintaxe YAML
```yaml
# ‚ùå ERRO - Indenta√ß√£o incorreta
route:
default_receiver: 'web.hook'
group_wait: 10s

# ‚úÖ CORRETO - Indenta√ß√£o correta
route:
  default_receiver: 'web.hook'
  group_wait: 10s
```

#### üìß Configura√ß√£o de Email
```yaml
# ‚ùå ERRO - Configura√ß√£o incompleta
receivers:
- name: 'email-alerts'
  email_configs:
  - to: 'admin@example.com'

# ‚úÖ CORRETO - Configura√ß√£o completa
global:
  smtp_smarthost: 'smtp.gmail.com:587'
  smtp_from: 'alerts@example.com'
  smtp_auth_username: 'alerts@example.com'
  smtp_auth_password: 'app-password'

receivers:
- name: 'email-alerts'
  email_configs:
  - to: 'admin@example.com'
    subject: 'Alert: {{ .GroupLabels.alertname }}'
    body: |
      {{ range .Alerts }}
      Alert: {{ .Annotations.summary }}
      {{ end }}
```

### üîç Valida√ß√£o de Configura√ß√£o

#### ‚úÖ Usando amtool
```bash
# Validar configura√ß√£o
amtool config check alertmanager.yml

# Mostrar configura√ß√£o processada
amtool config show --alertmanager.url=http://localhost:9093

# Testar roteamento
amtool config routes test \
  --config.file=alertmanager.yml \
  --tree \
  severity=critical alertname=DatabaseDown
```

#### üß™ Teste de Templates
```bash
# Testar template espec√≠fico
amtool template test \
  --template.file=templates/email.tmpl \
  --template.name=email.subject \
  --template.data-file=test-alert.json

# Arquivo de teste (test-alert.json)
{
  "Status": "firing",
  "GroupLabels": {"alertname": "TestAlert"},
  "CommonLabels": {"severity": "warning"},
  "Alerts": [{
    "Status": "firing",
    "Labels": {"instance": "localhost:9090"},
    "Annotations": {"summary": "Test alert"}
  }]
}
```

---

## 5. PROBLEMAS DE CONECTIVIDADE

### üåê Diagn√≥stico de Rede

#### üîç Testes de Conectividade
```bash
# Testar conectividade com Prometheus
curl -s http://prometheus:9090/api/v1/query?query=up

# Testar webhook
curl -X POST http://webhook.example.com/alerts \
  -H "Content-Type: application/json" \
  -d '[{"status":"firing","labels":{"alertname":"test"}}]'

# Testar SMTP
telnet smtp.gmail.com 587

# Testar Slack webhook
curl -X POST https://hooks.slack.com/services/YOUR/WEBHOOK/URL \
  -H "Content-Type: application/json" \
  -d '{"text":"Test message"}'
```

#### üê≥ Problemas Docker
```bash
# Verificar rede Docker
docker network ls
docker network inspect observability-stack-docker_default

# Testar conectividade entre containers
docker exec alertmanager ping prometheus
docker exec alertmanager nslookup prometheus

# Verificar portas expostas
docker port alertmanager
netstat -tlnp | grep 9093
```

### üîß Resolu√ß√£o de Problemas

#### üåê Proxy e Firewall
```bash
# Verificar vari√°veis de proxy
echo $HTTP_PROXY
echo $HTTPS_PROXY
echo $NO_PROXY

# Testar sem proxy
unset HTTP_PROXY HTTPS_PROXY
curl -s http://webhook.example.com/test

# Verificar firewall (Linux)
sudo iptables -L
sudo ufw status

# Verificar firewall (Windows)
netsh advfirewall show allprofiles
```

---

## 6. PROBLEMAS DE NOTIFICA√á√ÉO

### üìß Email

#### ‚ùå Problemas Comuns
```yaml
# Problema: Autentica√ß√£o SMTP
global:
  smtp_smarthost: 'smtp.gmail.com:587'
  smtp_from: 'alerts@example.com'
  # ‚ùå Faltando autentica√ß√£o

# Solu√ß√£o: Adicionar credenciais
global:
  smtp_smarthost: 'smtp.gmail.com:587'
  smtp_from: 'alerts@example.com'
  smtp_auth_username: 'alerts@example.com'
  smtp_auth_password: 'app-password'  # Use App Password, n√£o senha normal
  smtp_require_tls: true
```

#### üîç Debug de Email
```bash
# Testar SMTP manualmente
openssl s_client -connect smtp.gmail.com:587 -starttls smtp

# Logs espec√≠ficos de email
docker-compose logs alertmanager | grep -i "email\|smtp"

# Verificar configura√ß√£o TLS
curl -v --ssl smtp://smtp.gmail.com:587
```

### üí¨ Slack

#### ‚ùå Problemas Comuns
```yaml
# Problema: URL de webhook inv√°lida
receivers:
- name: 'slack-alerts'
  slack_configs:
  - api_url: 'https://hooks.slack.com/invalid-url'  # ‚ùå URL incorreta

# Solu√ß√£o: URL correta e configura√ß√£o completa
receivers:
- name: 'slack-alerts'
  slack_configs:
  - api_url: 'https://hooks.slack.com/services/T00000000/B00000000/XXXXXXXXXXXXXXXXXXXXXXXX'
    channel: '#alerts'
    username: 'Alertmanager'
    title: 'Alert: {{ .GroupLabels.alertname }}'
    text: |
      {{ range .Alerts }}
      *Alert:* {{ .Annotations.summary }}
      *Severity:* {{ .Labels.severity }}
      {{ end }}
```

#### üîç Debug de Slack
```bash
# Testar webhook manualmente
curl -X POST https://hooks.slack.com/services/YOUR/WEBHOOK/URL \
  -H "Content-Type: application/json" \
  -d '{
    "channel": "#alerts",
    "username": "Test",
    "text": "Test message from curl"
  }'

# Verificar resposta do Slack
curl -v -X POST https://hooks.slack.com/services/YOUR/WEBHOOK/URL \
  -H "Content-Type: application/json" \
  -d '{"text":"test"}' 2>&1 | grep -E "(HTTP|ok|invalid)"
```

### üîó Webhook

#### ‚ùå Problemas Comuns
```bash
# Problema: Endpoint n√£o responde
curl -X POST http://webhook.example.com/alerts
# curl: (7) Failed to connect to webhook.example.com port 80: Connection refused

# Diagn√≥stico
# 1. Verificar se o servi√ßo est√° rodando
ping webhook.example.com
nslookup webhook.example.com

# 2. Verificar porta
telnet webhook.example.com 80

# 3. Testar com timeout
curl --connect-timeout 10 -X POST http://webhook.example.com/alerts
```

---

## 7. PROBLEMAS DE PERFORMANCE

### üìä Identifica√ß√£o de Gargalos

#### üéØ M√©tricas de Performance
```promql
# Lat√™ncia de notifica√ß√µes
histogram_quantile(0.95, 
  rate(alertmanager_notification_latency_seconds_bucket[5m])
)

# Uso de mem√≥ria
process_resident_memory_bytes{job="alertmanager"}

# Uso de CPU
rate(process_cpu_seconds_total{job="alertmanager"}[5m])

# Alertas em fila
alertmanager_alerts_received_total - alertmanager_alerts_processed_total
```

#### üîç An√°lise de Logs
```bash
# Notifica√ß√µes lentas
docker-compose logs alertmanager | \
  grep "notification_latency" | \
  grep -E "[5-9][0-9]{3}ms|[0-9]+s"

# Timeouts
docker-compose logs alertmanager | grep -i timeout

# Erros de mem√≥ria
docker-compose logs alertmanager | grep -i "out of memory\|oom"
```

### ‚ö° Otimiza√ß√µes

#### üîß Configura√ß√£o de Performance
```yaml
# alertmanager.yml - Otimiza√ß√µes
global:
  # Reduzir timeouts para falhas r√°pidas
  smtp_timeout: 30s
  slack_api_url_timeout: 10s
  
route:
  # Agrupar mais alertas para reduzir notifica√ß√µes
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 12h
  
  # Agrupar por mais labels
  group_by: ['alertname', 'cluster', 'service']

receivers:
- name: 'optimized-webhook'
  webhook_configs:
  - url: 'http://webhook.example.com/alerts'
    # Reduzir timeout
    timeout: 10s
    # N√£o enviar alertas resolvidos se n√£o necess√°rio
    send_resolved: false
```

#### üê≥ Docker Otimizado
```yaml
# compose.yml - Recursos otimizados
services:
  alertmanager:
    image: prom/alertmanager:latest
    deploy:
      resources:
        limits:
          memory: 512M
          cpus: '0.5'
        reservations:
          memory: 256M
          cpus: '0.25'
    # Usar volume para persist√™ncia
    volumes:
      - alertmanager-data:/alertmanager
    # Configurar healthcheck
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:9093/-/healthy"]
      interval: 30s
      timeout: 10s
      retries: 3

volumes:
  alertmanager-data:
```

---

## 8. FERRAMENTAS DE DIAGN√ìSTICO

### üõ†Ô∏è amtool

#### üìã Comandos Essenciais
```bash
# Status geral
amtool --alertmanager.url=http://localhost:9093 status

# Listar alertas
amtool --alertmanager.url=http://localhost:9093 alert query

# Alertas por severity
amtool alert query severity=critical

# Silences ativos
amtool silence query

# Configura√ß√£o atual
amtool config show

# Testar roteamento
amtool config routes test severity=critical alertname=DatabaseDown
```

#### üß™ Simula√ß√£o de Alertas
```bash
# Criar alerta de teste
amtool alert add \
  alertname="TestAlert" \
  severity="warning" \
  instance="localhost:9090" \
  summary="Alert de teste"

# Verificar se foi processado
amtool alert query alertname="TestAlert"

# Criar silence para teste
amtool silence add \
  alertname="TestAlert" \
  --duration="1h" \
  --comment="Teste de silence"
```

### üîç Scripts de Diagn√≥stico

#### ü©∫ Health Check Completo
```bash
#!/bin/bash
# alertmanager-health-check.sh

AM_URL="http://localhost:9093"
ERRORS=0

echo "üîç Alertmanager Health Check"
echo "================================"

# 1. Verificar se est√° rodando
echo -n "üì° Conectividade: "
if curl -s "$AM_URL/-/healthy" >/dev/null; then
    echo "‚úÖ OK"
else
    echo "‚ùå FALHA - Alertmanager n√£o est√° acess√≠vel"
    ((ERRORS++))
fi

# 2. Verificar configura√ß√£o
echo -n "‚öôÔ∏è  Configura√ß√£o: "
if amtool --alertmanager.url="$AM_URL" config show >/dev/null 2>&1; then
    echo "‚úÖ OK"
else
    echo "‚ùå FALHA - Configura√ß√£o inv√°lida"
    ((ERRORS++))
fi

# 3. Verificar alertas
echo -n "üö® Alertas ativos: "
ALERT_COUNT=$(amtool --alertmanager.url="$AM_URL" alert query --output=json 2>/dev/null | jq '. | length' 2>/dev/null || echo "0")
echo "$ALERT_COUNT alertas"

# 4. Verificar silences
echo -n "üîá Silences ativos: "
SILENCE_COUNT=$(amtool --alertmanager.url="$AM_URL" silence query --output=json 2>/dev/null | jq '. | length' 2>/dev/null || echo "0")
echo "$SILENCE_COUNT silences"

# 5. Verificar m√©tricas
echo -n "üìä M√©tricas: "
if curl -s "$AM_URL/metrics" | grep -q "alertmanager_build_info"; then
    echo "‚úÖ OK"
else
    echo "‚ùå FALHA - M√©tricas n√£o dispon√≠veis"
    ((ERRORS++))
fi

echo "================================"
if [ $ERRORS -eq 0 ]; then
    echo "‚úÖ Alertmanager est√° saud√°vel!"
    exit 0
else
    echo "‚ùå Encontrados $ERRORS problemas"
    exit 1
fi
```

#### üìä Monitor de Performance
```bash
#!/bin/bash
# alertmanager-performance.sh

AM_URL="http://localhost:9093"

echo "üìä Alertmanager Performance Monitor"
echo "==================================="

while true; do
    # Coletar m√©tricas
    METRICS=$(curl -s "$AM_URL/metrics")
    
    # Alertas recebidos por minuto
    ALERTS_RATE=$(echo "$METRICS" | grep "alertmanager_alerts_received_total" | tail -1 | awk '{print $2}')
    
    # Notifica√ß√µes enviadas por minuto
    NOTIFICATIONS_RATE=$(echo "$METRICS" | grep "alertmanager_notifications_total" | tail -1 | awk '{print $2}')
    
    # Notifica√ß√µes falhadas
    NOTIFICATIONS_FAILED=$(echo "$METRICS" | grep "alertmanager_notifications_failed_total" | tail -1 | awk '{print $2}')
    
    # Uso de mem√≥ria
    MEMORY_USAGE=$(echo "$METRICS" | grep "process_resident_memory_bytes" | awk '{print $2}')
    MEMORY_MB=$((MEMORY_USAGE / 1024 / 1024))
    
    # Exibir resultados
    clear
    echo "üìä Alertmanager Performance - $(date)"
    echo "====================================="
    echo "üö® Alertas recebidos: $ALERTS_RATE"
    echo "üì§ Notifica√ß√µes enviadas: $NOTIFICATIONS_RATE"
    echo "‚ùå Notifica√ß√µes falhadas: $NOTIFICATIONS_FAILED"
    echo "üíæ Uso de mem√≥ria: ${MEMORY_MB}MB"
    
    # Calcular taxa de sucesso
    if [ "$NOTIFICATIONS_RATE" -gt 0 ]; then
        SUCCESS_RATE=$(echo "scale=2; (($NOTIFICATIONS_RATE - $NOTIFICATIONS_FAILED) / $NOTIFICATIONS_RATE) * 100" | bc)
        echo "‚úÖ Taxa de sucesso: ${SUCCESS_RATE}%"
    fi
    
    sleep 5
done
```

---

## 9. CEN√ÅRIOS COMUNS

### üö® "Alertas n√£o est√£o sendo enviados"

#### üîç Diagn√≥stico
```bash
# 1. Verificar se alertas est√£o chegando
amtool alert query

# 2. Verificar roteamento
amtool config routes test severity=critical alertname=DatabaseDown

# 3. Verificar logs de notifica√ß√£o
docker-compose logs alertmanager | grep -E "(notification|notify)"

# 4. Testar receiver manualmente
curl -X POST http://webhook.example.com/test
```

#### ‚úÖ Solu√ß√µes
```yaml
# Problema comum: Roteamento incorreto
route:
  default_receiver: 'null'  # ‚ùå Receiver que n√£o existe
  
# Solu√ß√£o: Receiver v√°lido
route:
  default_receiver: 'web.hook'
  
receivers:
- name: 'web.hook'
  webhook_configs:
  - url: 'http://webhook.example.com/alerts'
```

### üîÑ "Muitas notifica√ß√µes duplicadas"

#### üîç Diagn√≥stico
```bash
# Verificar configura√ß√£o de agrupamento
amtool config show | grep -A 10 "group_"

# Verificar alertas ativos
amtool alert query --output=json | jq '.[] | {alertname: .labels.alertname, instance: .labels.instance}'
```

#### ‚úÖ Solu√ß√µes
```yaml
# Problema: Agrupamento insuficiente
route:
  group_by: ['alertname']  # ‚ùå Muito gen√©rico
  group_wait: 5s          # ‚ùå Muito r√°pido
  
# Solu√ß√£o: Agrupamento melhor
route:
  group_by: ['alertname', 'cluster', 'service']
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 12h
```

### üêå "Notifica√ß√µes muito lentas"

#### üîç Diagn√≥stico
```promql
# Verificar lat√™ncia
histogram_quantile(0.95, 
  rate(alertmanager_notification_latency_seconds_bucket[5m])
)

# Verificar timeouts
rate(alertmanager_notifications_failed_total{reason="timeout"}[5m])
```

#### ‚úÖ Solu√ß√µes
```yaml
# Otimizar timeouts
global:
  smtp_timeout: 10s
  
receivers:
- name: 'fast-webhook'
  webhook_configs:
  - url: 'http://fast-webhook.example.com/alerts'
    timeout: 5s
    max_alerts: 10  # Limitar n√∫mero de alertas por request
```

---

## 10. PREVEN√á√ÉO DE PROBLEMAS

### üõ°Ô∏è Monitoramento Proativo

#### üìä Alertas para o Alertmanager
```yaml
# prometheus-rules.yml
groups:
- name: alertmanager.rules
  rules:
  # Alertmanager down
  - alert: AlertmanagerDown
    expr: up{job="alertmanager"} == 0
    for: 1m
    labels:
      severity: critical
    annotations:
      summary: "Alertmanager est√° down"
      
  # Falhas de notifica√ß√£o
  - alert: AlertmanagerNotificationsFailing
    expr: rate(alertmanager_notifications_failed_total[5m]) > 0.1
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "Alertmanager com falhas de notifica√ß√£o"
      
  # Configura√ß√£o n√£o recarregada
  - alert: AlertmanagerConfigNotReloaded
    expr: time() - alertmanager_config_last_reload_success_timestamp_seconds > 3600
    for: 0m
    labels:
      severity: warning
    annotations:
      summary: "Configura√ß√£o do Alertmanager n√£o foi recarregada h√° mais de 1h"
```

### üß™ Testes Automatizados

#### üîÑ CI/CD Pipeline
```yaml
# .github/workflows/alertmanager-test.yml
name: Test Alertmanager Config

on:
  push:
    paths:
      - 'alertmanager.yml'
      - 'templates/**'

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    
    - name: Download amtool
      run: |
        wget https://github.com/prometheus/alertmanager/releases/download/v0.25.0/alertmanager-0.25.0.linux-amd64.tar.gz
        tar xzf alertmanager-0.25.0.linux-amd64.tar.gz
        sudo mv alertmanager-0.25.0.linux-amd64/amtool /usr/local/bin/
    
    - name: Validate Config
      run: amtool config check alertmanager.yml
    
    - name: Test Templates
      run: |
        for template in templates/*.tmpl; do
          echo "Testing $template"
          amtool template test \
            --template.file="$template" \
            --template.data-file=tests/test-alert.json
        done
    
    - name: Test Routing
      run: |
        amtool config routes test \
          --config.file=alertmanager.yml \
          severity=critical alertname=TestAlert
```

### üìã Checklist de Manuten√ß√£o

#### üóìÔ∏è Semanal
- [ ] Verificar logs de erro
- [ ] Revisar m√©tricas de performance
- [ ] Testar notifica√ß√µes cr√≠ticas
- [ ] Verificar espa√ßo em disco

#### üóìÔ∏è Mensal
- [ ] Atualizar vers√£o do Alertmanager
- [ ] Revisar configura√ß√£o de receivers
- [ ] Limpar silences expirados
- [ ] Backup da configura√ß√£o

#### üóìÔ∏è Trimestral
- [ ] Revisar templates de notifica√ß√£o
- [ ] Otimizar regras de roteamento
- [ ] Treinar equipe em novos recursos
- [ ] Documentar mudan√ßas

---

## üéØ RESUMO DO M√ìDULO

### ‚úÖ O que voc√™ aprendeu:

1. **Diagn√≥stico inicial** - Checklist e verifica√ß√µes b√°sicas
2. **Logs e debugging** - Configura√ß√£o e an√°lise de logs
3. **M√©tricas de monitoramento** - M√©tricas essenciais e dashboards
4. **Problemas de configura√ß√£o** - Erros comuns e valida√ß√£o
5. **Problemas de conectividade** - Diagn√≥stico de rede
6. **Problemas de notifica√ß√£o** - Debug de email, Slack, webhook
7. **Problemas de performance** - Identifica√ß√£o e otimiza√ß√£o
8. **Ferramentas de diagn√≥stico** - amtool e scripts personalizados
9. **Cen√°rios comuns** - Problemas frequentes e solu√ß√µes
10. **Preven√ß√£o de problemas** - Monitoramento proativo e testes

### üîß Principais conceitos:
- **Diagn√≥stico sistem√°tico** - Abordagem estruturada para resolver problemas
- **Logs estruturados** - An√°lise eficiente de logs JSON
- **M√©tricas de sa√∫de** - Monitoramento proativo do Alertmanager
- **Valida√ß√£o automatizada** - Testes de configura√ß√£o e templates
- **Performance tuning** - Otimiza√ß√£o de recursos e lat√™ncia

### üöÄ Pr√≥ximos Passos

Agora que voc√™ sabe resolver problemas, vamos aprender sobre **integra√ß√£o avan√ßada**:

**Pr√≥ximo m√≥dulo:** [09-integracao-avancada.md](09-integracao-avancada.md) - Integra√ß√£o com outras ferramentas

---

## üîó Links Relacionados

- **[Anterior: Templates](07-templates.md)**
- **[Pr√≥ximo: Integra√ß√£o Avan√ßada](09-integracao-avancada.md)**
- **[Voltar ao √çndice](README.md)**