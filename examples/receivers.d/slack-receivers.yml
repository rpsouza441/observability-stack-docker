# ============================================================================
# SLACK RECEIVERS - CONFIGURA√á√ÉO MODULAR
# ============================================================================
# Este arquivo cont√©m configura√ß√µes espec√≠ficas para receivers do Slack,
# organizados por equipe e tipo de alerta.
#
# NOTA: O Alertmanager n√£o suporta includes nativamente para receivers.
# Este arquivo serve como refer√™ncia para implementa√ß√£o via:
# - Ferramentas de templating (Helm, Ansible, Jinja2)
# - Scripts de deployment que concatenam arquivos
# - Ferramentas de CI/CD que processam configura√ß√µes modulares
# ============================================================================

# ========================================
# CONFIGURA√á√ïES SLACK GLOBAIS
# ========================================
# Vari√°veis de ambiente necess√°rias:
# - SLACK_WEBHOOK_URL: Webhook principal
# - SLACK_SRE_WEBHOOK: Webhook da equipe SRE
# - SLACK_DEV_WEBHOOK: Webhook da equipe Dev
# - SLACK_PROD_WEBHOOK: Webhook para produ√ß√£o
# - SLACK_STAGING_WEBHOOK: Webhook para staging
# - SLACK_MONITORING_WEBHOOK: Webhook para monitoramento
# - SLACK_DBA_WEBHOOK: Webhook para DBAs
# - SLACK_WEBAPP_WEBHOOK: Webhook para webapp
# - SLACK_API_WEBHOOK: Webhook para API
# - SLACK_TEST_WEBHOOK: Webhook para testes

# ========================================
# RECEIVERS SLACK - CR√çTICOS
# ========================================

# Alertas cr√≠ticos gerais
critical-alerts-slack:
  slack_configs:
    - api_url: '${SLACK_WEBHOOK_URL}'
      channel: '#critical-alerts'
      title: 'üî¥ CRITICAL: {{ .GroupLabels.alertname }}'
      text: |
        {{ range .Alerts }}
        **{{ .Annotations.summary }}**
        
        ‚Ä¢ **Severity:** {{ .Labels.severity | upper }}
        ‚Ä¢ **Instance:** {{ .Labels.instance }}
        ‚Ä¢ **Team:** {{ .Labels.team }}
        ‚Ä¢ **Environment:** {{ .Labels.environment }}
        
        {{ .Annotations.description }}
        
        <{{ .Annotations.runbook_url }}|üìñ Runbook> | Alert ID: `{{ .Annotations.alert_id }}`
        {{ end }}
      color: 'danger'
      send_resolved: true
      title_link: 'http://alertmanager.company.com'
      footer: 'Alertmanager'
      footer_icon: 'https://prometheus.io/assets/favicons/android-chrome-192x192.png'

# SRE - Alertas cr√≠ticos
sre-critical-slack:
  slack_configs:
    - api_url: '${SLACK_SRE_WEBHOOK}'
      channel: '#sre-critical'
      title: 'üö® SRE CRITICAL: {{ .GroupLabels.alertname }}'
      text: |
        {{ range .Alerts }}
        **{{ .Annotations.summary }}**
        
        ‚Ä¢ **Instance:** {{ .Labels.instance }}
        ‚Ä¢ **Environment:** {{ .Labels.environment }}
        ‚Ä¢ **Started:** {{ .StartsAt.Format "15:04:05" }}
        
        {{ .Annotations.description }}
        
        **Actions:**
        ‚Ä¢ Check runbook: {{ .Annotations.runbook_url }}
        ‚Ä¢ Alert ID: `{{ .Annotations.alert_id }}`
        ‚Ä¢ Escalate if needed: @sre-oncall
        {{ end }}
      color: 'danger'
      send_resolved: true
      actions:
        - type: 'button'
          text: 'üîç View in Grafana'
          url: 'http://grafana.company.com/d/node-exporter'
        - type: 'button'
          text: 'üìä View in Prometheus'
          url: 'http://prometheus.company.com/alerts'

# Development - Alertas cr√≠ticos
dev-critical-slack:
  slack_configs:
    - api_url: '${SLACK_DEV_WEBHOOK}'
      channel: '#dev-critical'
      title: 'üî¥ DEV CRITICAL: {{ .GroupLabels.alertname }}'
      text: |
        {{ range .Alerts }}
        **{{ .Annotations.summary }}**
        
        ‚Ä¢ **Service:** {{ .Labels.service }}
        ‚Ä¢ **Instance:** {{ .Labels.instance }}
        ‚Ä¢ **Environment:** {{ .Labels.environment }}
        
        {{ .Annotations.description }}
        
        <{{ .Annotations.runbook_url }}|üìñ Runbook>
        {{ end }}
      color: 'danger'
      send_resolved: true
      fields:
        - title: 'Service'
          value: '{{ .GroupLabels.service }}'
          short: true
        - title: 'Environment'
          value: '{{ .GroupLabels.environment }}'
          short: true

# ========================================
# RECEIVERS SLACK - REGULARES
# ========================================

# SRE - Notifica√ß√µes regulares
sre-notifications-slack:
  slack_configs:
    - api_url: '${SLACK_SRE_WEBHOOK}'
      channel: '#sre-alerts'
      title: '{{ .GroupLabels.severity | upper }}: {{ .GroupLabels.alertname }}'
      text: |
        {{ range .Alerts }}
        {{ .Annotations.summary }}
        
        ‚Ä¢ **Instance:** {{ .Labels.instance }}
        ‚Ä¢ **Environment:** {{ .Labels.environment }}
        ‚Ä¢ **Team:** {{ .Labels.team }}
        {{ end }}
      color: '{{ if eq .GroupLabels.severity "warning" }}warning{{ else }}good{{ end }}'
      send_resolved: true
      short_fields: true

# Development - Notifica√ß√µes regulares
dev-notifications-slack:
  slack_configs:
    - api_url: '${SLACK_DEV_WEBHOOK}'
      channel: '#dev-alerts'
      title: '{{ .GroupLabels.severity | upper }}: {{ .GroupLabels.alertname }}'
      text: |
        {{ range .Alerts }}
        {{ .Annotations.summary }}
        
        ‚Ä¢ **Service:** {{ .Labels.service }}
        ‚Ä¢ **Instance:** {{ .Labels.instance }}
        ‚Ä¢ **Environment:** {{ .Labels.environment }}
        {{ end }}
      color: '{{ if eq .GroupLabels.severity "warning" }}warning{{ else }}good{{ end }}'
      send_resolved: true
      thumb_url: 'https://prometheus.io/assets/favicons/android-chrome-192x192.png'

# ========================================
# RECEIVERS SLACK - POR AMBIENTE
# ========================================

# Produ√ß√£o
production-alerts-slack:
  slack_configs:
    - api_url: '${SLACK_PROD_WEBHOOK}'
      channel: '#production-alerts'
      title: 'üè≠ PROD {{ .GroupLabels.severity | upper }}: {{ .GroupLabels.alertname }}'
      text: |
        {{ range .Alerts }}
        **{{ .Annotations.summary }}**
        
        ‚Ä¢ **Service:** {{ .Labels.service }}
        ‚Ä¢ **Instance:** {{ .Labels.instance }}
        ‚Ä¢ **Started:** {{ .StartsAt.Format "2006-01-02 15:04:05" }}
        
        {{ .Annotations.description }}
        
        **Runbook:** {{ .Annotations.runbook_url }}
        {{ end }}
      color: '{{ if eq .GroupLabels.severity "critical" }}danger{{ else if eq .GroupLabels.severity "warning" }}warning{{ else }}good{{ end }}'
      send_resolved: true
      fields:
        - title: 'Priority'
          value: '{{ .GroupLabels.priority | default "P2" }}'
          short: true
        - title: 'Team'
          value: '{{ .GroupLabels.team }}'
          short: true

# Staging
staging-alerts-slack:
  slack_configs:
    - api_url: '${SLACK_STAGING_WEBHOOK}'
      channel: '#staging-alerts'
      title: 'üß™ STAGING: {{ .GroupLabels.alertname }}'
      text: |
        {{ range .Alerts }}
        {{ .Annotations.summary }}
        
        ‚Ä¢ **Service:** {{ .Labels.service }}
        ‚Ä¢ **Instance:** {{ .Labels.instance }}
        {{ end }}
      color: 'warning'
      send_resolved: true
      icon_emoji: ':warning:'

# Development environment
dev-environment-slack:
  slack_configs:
    - api_url: '${SLACK_DEV_WEBHOOK}'
      channel: '#dev-environment'
      title: 'üîß DEV: {{ .GroupLabels.alertname }}'
      text: |
        {{ range .Alerts }}
        {{ .Annotations.summary }}
        
        ‚Ä¢ **Service:** {{ .Labels.service }}
        ‚Ä¢ **Instance:** {{ .Labels.instance }}
        {{ end }}
      color: 'good'
      send_resolved: true
      icon_emoji: ':hammer_and_wrench:'

# ========================================
# RECEIVERS SLACK - POR SERVI√áO
# ========================================

# Monitoramento
monitoring-team-slack:
  slack_configs:
    - api_url: '${SLACK_MONITORING_WEBHOOK}'
      channel: '#monitoring-alerts'
      title: 'üìä MONITORING: {{ .GroupLabels.alertname }}'
      text: |
        {{ range .Alerts }}
        {{ .Annotations.summary }}
        
        ‚Ä¢ **Component:** {{ .Labels.job }}
        ‚Ä¢ **Instance:** {{ .Labels.instance }}
        ‚Ä¢ **Status:** {{ if eq .Status "firing" }}üî• FIRING{{ else }}‚úÖ RESOLVED{{ end }}
        {{ end }}
      color: 'warning'
      send_resolved: true
      actions:
        - type: 'button'
          text: 'üîç Check Prometheus'
          url: 'http://prometheus.company.com/targets'
        - type: 'button'
          text: 'üìä Check Grafana'
          url: 'http://grafana.company.com'

# Database
database-team-slack:
  slack_configs:
    - api_url: '${SLACK_DBA_WEBHOOK}'
      channel: '#database-alerts'
      title: 'üóÑÔ∏è DB: {{ .GroupLabels.alertname }}'
      text: |
        {{ range .Alerts }}
        {{ .Annotations.summary }}
        
        ‚Ä¢ **Database:** {{ .Labels.service }}
        ‚Ä¢ **Instance:** {{ .Labels.instance }}
        ‚Ä¢ **Type:** {{ .Labels.db_type | default "Unknown" }}
        {{ end }}
      color: 'warning'
      send_resolved: true
      fields:
        - title: 'Database Type'
          value: '{{ .GroupLabels.db_type | default "Generic" }}'
          short: true
        - title: 'Severity'
          value: '{{ .GroupLabels.severity | upper }}'
          short: true

# Web Application
webapp-team-slack:
  slack_configs:
    - api_url: '${SLACK_WEBAPP_WEBHOOK}'
      channel: '#webapp-alerts'
      title: 'üåê WEBAPP: {{ .GroupLabels.alertname }}'
      text: |
        {{ range .Alerts }}
        {{ .Annotations.summary }}
        
        ‚Ä¢ **Application:** {{ .Labels.service }}
        ‚Ä¢ **Instance:** {{ .Labels.instance }}
        ‚Ä¢ **URL:** {{ .Labels.url | default "N/A" }}
        {{ end }}
      color: 'warning'
      send_resolved: true
      actions:
        - type: 'button'
          text: 'üåê Check Application'
          url: '{{ .GroupLabels.url | default "http://webapp.company.com" }}'

# API Services
api-team-slack:
  slack_configs:
    - api_url: '${SLACK_API_WEBHOOK}'
      channel: '#api-alerts'
      title: 'üîå API: {{ .GroupLabels.alertname }}'
      text: |
        {{ range .Alerts }}
        {{ .Annotations.summary }}
        
        ‚Ä¢ **API:** {{ .Labels.service }}
        ‚Ä¢ **Endpoint:** {{ .Labels.endpoint | default "N/A" }}
        ‚Ä¢ **Instance:** {{ .Labels.instance }}
        ‚Ä¢ **Method:** {{ .Labels.method | default "N/A" }}
        {{ end }}
      color: 'warning'
      send_resolved: true
      fields:
        - title: 'API Version'
          value: '{{ .GroupLabels.version | default "v1" }}'
          short: true
        - title: 'Response Code'
          value: '{{ .GroupLabels.code | default "N/A" }}'
          short: true

# ========================================
# RECEIVERS SLACK - ESPECIAIS
# ========================================

# Testes
test-notifications-slack:
  slack_configs:
    - api_url: '${SLACK_TEST_WEBHOOK}'
      channel: '#alertmanager-tests'
      title: 'üß™ TEST ALERT: {{ .GroupLabels.alertname }}'
      text: |
        {{ range .Alerts }}
        **Test Alert Triggered**
        
        ‚Ä¢ **Alert:** {{ .Annotations.summary }}
        ‚Ä¢ **Time:** {{ .StartsAt.Format "2006-01-02 15:04:05" }}
        ‚Ä¢ **Status:** {{ .Status }}
        {{ end }}
      color: 'good'
      send_resolved: true
      icon_emoji: ':test_tube:'

# ============================================================================
# CONFIGURA√á√ÉO DE TEMPLATES SLACK
# ============================================================================
#
# 1. CAMPOS DISPON√çVEIS:
#    - .GroupLabels: Labels agrupados do alerta
#    - .CommonLabels: Labels comuns a todos os alertas
#    - .CommonAnnotations: Annotations comuns
#    - .Alerts: Array de alertas individuais
#    - .Status: Status do grupo (firing/resolved)
#
# 2. FORMATA√á√ÉO SLACK:
#    - **texto**: Negrito
#    - _texto_: It√°lico
#    - `c√≥digo`: C√≥digo inline
#    - ```c√≥digo```: Bloco de c√≥digo
#    - <url|texto>: Link com texto personalizado
#    - @channel, @here: Men√ß√µes especiais
#    - :emoji:: Emojis
#
# 3. CORES RECOMENDADAS:
#    - danger: Vermelho (cr√≠tico)
#    - warning: Amarelo (warning)
#    - good: Verde (info/resolved)
#    - #FF0000: Cores customizadas em hex
#
# 4. A√á√ïES E BOT√ïES:
#    - M√°ximo 5 a√ß√µes por mensagem
#    - Tipos: button, select
#    - URLs devem ser HTTPS quando poss√≠vel
#
# 5. CAMPOS E ATTACHMENTS:
#    - short: true/false para campos lado a lado
#    - thumb_url: Thumbnail pequeno
#    - image_url: Imagem grande
#    - footer: Texto no rodap√©
#
# 6. VARI√ÅVEIS DE AMBIENTE:
#    - Sempre use ${VAR} para secrets
#    - Configure fallbacks quando apropriado
#    - Documente todas as vari√°veis necess√°rias
#
# 7. TESTE E VALIDA√á√ÉO:
#    - Use canal de teste primeiro
#    - Valide templates com dados reais
#    - Teste resolu√ß√£o de alertas
#    - Verifique formata√ß√£o em mobile
# ============================================================================